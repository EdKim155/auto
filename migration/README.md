# Автоматизация миграции Telegram-бота

## Описание

Набор скриптов для автоматизированной миграции системы Telegram-бота с сервера на сервер с соблюдением лучших практик DevOps.

## Структура

```
migration/
├── README.md                    # Документация
├── config.sh                    # Конфигурация миграции
├── 01_audit_source.sh          # Аудит исходного сервера
├── 02_prepare_target.sh        # Подготовка целевого сервера
├── 03_backup_and_transfer.sh   # Резервное копирование и перенос
├── 04_setup_environment.sh     # Настройка окружения
├── 05_configure_service.sh     # Настройка systemd-сервиса
├── 06_validate_migration.sh    # Валидация миграции
├── 07_setup_monitoring.sh      # Настройка мониторинга
├── rollback.sh                 # План отката
└── utils.sh                    # Вспомогательные функции
```

## Использование

### Подготовка

1. Проверьте конфигурацию в `config.sh`
2. Убедитесь, что SSH-ключи настроены корректно
3. Проверьте доступность обоих серверов

### Выполнение миграции

Запустите скрипты последовательно:

```bash
cd /Users/edgark/auto/migration

# 1. Аудит исходного сервера
./01_audit_source.sh

# 2. Подготовка целевого сервера
./02_prepare_target.sh

# 3. Резервное копирование и перенос
./03_backup_and_transfer.sh

# 4. Настройка окружения
./04_setup_environment.sh

# 5. Настройка systemd-сервиса
./05_configure_service.sh

# 6. Валидация
./06_validate_migration.sh

# 7. Настройка мониторинга
./07_setup_monitoring.sh
```

### В случае проблем

```bash
# Откат на исходный сервер
./rollback.sh
```

## Особенности

- ✅ Идемпотентность (можно запускать несколько раз)
- ✅ Детальное логирование всех операций
- ✅ Проверка целостности данных (checksums)
- ✅ Автоматическое резервное копирование
- ✅ План отката в случае проблем
- ✅ Валидация на каждом этапе

## Логи

Все логи сохраняются в `migration/logs/` с timestamp.

## Безопасность

- Файлы .env и .session защищены (chmod 600)
- Передача данных через защищенный SSH
- Резервные копии зашифрованы (опционально)
