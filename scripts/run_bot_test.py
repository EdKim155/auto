#!/usr/bin/env python3
"""
Запускалка для тестирования бота @ACarriers_bot
Позволяет выбрать режим тестирования
"""

import sys
import subprocess


def print_header():
    """Вывод заголовка"""
    print("\n" + "="*70)
    print(" "*15 + "BOT TESTER FOR @ACarriers_bot")
    print("="*70)


def print_menu():
    """Вывод меню выбора"""
    print("\nВыберите режим тестирования:\n")
    print("  1. Автоматический режим")
    print("     - Быстрое автоматическое тестирование")
    print("     - Отправка /start и клик по первой кнопке")
    print("     - Автоматический отчет\n")
    print("  2. Интерактивный режим (РЕКОМЕНДУЕТСЯ)")
    print("     - Полный контроль через консольное меню")
    print("     - Выбор кнопок вручную")
    print("     - Просмотр истории и статистики\n")
    print("  3. Справка")
    print("     - Открыть документацию\n")
    print("  0. Выход\n")
    print("="*70)


def show_help():
    """Показать справку"""
    help_text = """
╔══════════════════════════════════════════════════════════════════════╗
║                         СПРАВКА                                      ║
╚══════════════════════════════════════════════════════════════════════╝

АВТОМАТИЧЕСКИЙ РЕЖИМ:
  Запуск: python test_acarriers_bot.py

  Что делает:
  - Подключается к боту @ACarriers_bot
  - Отправляет команду /start
  - Автоматически нажимает первую доступную кнопку
  - Пытается вернуться в главное меню
  - Выводит детальный отчет

  Использовать когда:
  - Нужно быстро проверить доступность бота
  - Требуется базовый тест функционала
  - Нужен автоматический режим без участия пользователя

ИНТЕРАКТИВНЫЙ РЕЖИМ (РЕКОМЕНДУЕТСЯ):
  Запуск: python test_acarriers_bot_interactive.py

  Возможности:
  - Ручной выбор кнопок для нажатия
  - Отправка произвольных команд
  - Просмотр истории всех взаимодействий
  - Защита от случайного нажатия запрещенных кнопок
  - Детальная статистика в реальном времени

  Команды:
    1-9         - Быстро нажать кнопку (1-9)
    b <номер>   - Нажать кнопку с любым номером
    s           - Отправить /start
    c <команда> - Отправить произвольную команду
    l           - Показать все кнопки
    h           - История сообщений
    v           - Показать нажатые кнопки
    sum         - Итоговая статистика
    q           - Выход

  Использовать когда:
  - Нужно детально исследовать поведение бота
  - Требуется протестировать разные сценарии
  - Необходим полный контроль над процессом

ЛОГИ:
  - test_acarriers_bot.log           (автоматический режим)
  - test_acarriers_bot_interactive.log (интерактивный режим)

НАСТРОЙКА:
  Убедитесь, что в файле .env указаны:
  - API_ID=27270483
  - API_HASH=054487666c6a886114b50b6210e8c051
  - PHONE=+79507380505

ЗАПРЕЩЕННЫЕ КНОПКИ:
  Автоматически блокируются кнопки содержащие:
  - подтвердить, подтверд
  - забронировать
  - взять, беру

ДОКУМЕНТАЦИЯ:
  Полная документация: TEST_BOT_README.md

╚══════════════════════════════════════════════════════════════════════╝
"""
    print(help_text)
    input("\nНажмите Enter для продолжения...")


def run_auto_mode():
    """Запуск автоматического режима"""
    print("\n" + "="*70)
    print("Запуск АВТОМАТИЧЕСКОГО режима...")
    print("="*70 + "\n")
    try:
        subprocess.run([sys.executable, 'test_acarriers_bot.py'])
    except KeyboardInterrupt:
        print("\n\nТестирование прервано пользователем")
    except Exception as e:
        print(f"\nОшибка при запуске: {e}")


def run_interactive_mode():
    """Запуск интерактивного режима"""
    print("\n" + "="*70)
    print("Запуск ИНТЕРАКТИВНОГО режима...")
    print("="*70 + "\n")
    try:
        subprocess.run([sys.executable, 'test_acarriers_bot_interactive.py'])
    except KeyboardInterrupt:
        print("\n\nТестирование прервано пользователем")
    except Exception as e:
        print(f"\nОшибка при запуске: {e}")


def main():
    """Главная функция"""
    while True:
        print_header()
        print_menu()

        try:
            choice = input("Выберите опцию (0-3): ").strip()

            if choice == '0':
                print("\nВыход из программы. До свидания!")
                break

            elif choice == '1':
                run_auto_mode()

            elif choice == '2':
                run_interactive_mode()

            elif choice == '3':
                show_help()

            else:
                print("\n❌ Неверный выбор. Пожалуйста, выберите 0-3")
                input("\nНажмите Enter для продолжения...")

        except KeyboardInterrupt:
            print("\n\nВыход из программы. До свидания!")
            break
        except Exception as e:
            print(f"\n❌ Ошибка: {e}")
            input("\nНажмите Enter для продолжения...")


if __name__ == '__main__':
    main()
